name: Publish Release

on:
    push:
        tags: 
          - "v*.*.*"
    workflow_dispatch:

jobs:
  build:
    uses: ./.github/workflows/dotnet.yml 
  release:
    runs-on: ubuntu-latest
    needs: build
    permissions:
      contents: write
    steps:
    # Step 1: check out the repository code
    - name: Get code
      uses: actions/checkout@v6
    # Step 2: generate release notes automatically
    - name: Generate Release Notes
      id: release_notes
      run: |
        echo "## Last commit" > release_notes.md
        echo "" >> release_notes.md
        echo "$(git log -1 --pretty=format:"[%h] %B")" >> release_notes.md
    # Step 3: create a GitHub Release
    - name: Release
      uses: softprops/action-gh-release@v2

      # This condition ensures that the release is created
      # only when the workflow is triggered by a Git tag push
      if: startsWith(github.ref, 'refs/tags/')

      with:
        # Use the generated Markdown file as the body of the release
        body_path: ./release_notes.md
